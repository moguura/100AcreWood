<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity4</title>
<style>
/* 全体のスタイル */
body {
    font-family: Arial, sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 0;
    background-color: #f9f9f9;
    color: #333;
    font-size: 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}

h1 {
    text-align: center;
    margin: 40px 0 60px;
    font-size: 40px;
}

/* 質問エリアのスタイル */
.question {
    margin-bottom: 100px;
    text-align: center;
    font-size: 24px;
}
.question img {
    width: 340px;
    height: auto;
    object-fit: cover;
    display: block;
    margin: 20px auto 10px;
    max-width: 100%;
}
.question p:first-child {
    font-weight: bold;
    font-size: 28px;
    color: #007bff;
}

/* キューのスタイル（緑色と太字） */
.highlight {
    color: green;
    font-weight: bold;
}

/* マイクボタンのスタイル */
.mic-button {
    background-image: url("https://raw.githubusercontent.com/moguura/my-images/main/%E3%83%9E%E3%82%A4%E3%82%AF%E3%81%AE%E3%83%95%E3%83%AA%E3%83%BC%E3%82%A2%E3%82%A4%E3%82%B3%E3%83%B3%E3%81%9D%E3%81%AE21.png");
    background-size: cover;
    background-repeat: no-repeat;
    border: none;
    width: 70px;
    height: 70px;
    border-radius: 50%;
    cursor: pointer;
    margin: 10px auto;
    transition: box-shadow 0.3s ease-in-out;
}
.mic-button:active,
.mic-button.recording {
    box-shadow: 0 0 15px rgba(255, 0, 0, 0.8);
}
.mic-button:disabled {
    background-color: gray;
    cursor: not-allowed;
}

/* 説明文のスタイル */
.instructions {
    background-color: #ffffff;
    border: 1px solid #d1d5db;
    border-radius: 5px;
    padding: 15px;
    margin-bottom: 20px;
    font-size: 24px;
    line-height: 1.6;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    max-width: 900px;
    width: 100%;
    text-align: center;
    margin: 0 auto;
}

/* ビデオコンテナ */
.video-container {
    text-align: center;
    margin-top: 40px;
    margin-bottom: 20px;
}
.video-container video {
    width: 80%;
    max-width: 800px;
    height: auto;
    border: 1px solid #d1d5db;
    border-radius: 5px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
}

/* フィードバック全体を初期非表示 */
.feedback,
.feedback-text,
.feedback-icons {
    display: none;
}
.feedback-icons {
    align-items: center;
    margin-left: 12px;
}
.feedback-icons img {
    width: 32px;
    margin-right: 6px;
}
.feedback-text {
    display: block;
    text-align: center;
    margin-top: 8px;
    font-size: 1em;
    color: #333;
}

/* マイクボタン＋アイコンを横並び */
.interaction {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 10px;
}

/* 次ページリンク */
#nextPageLink {
    display: none;
    text-align: center;
    margin: 30px auto;
    color: #007bff;
    text-decoration: none;
    font-size: 28px;
    font-weight: bold;
    padding: 10px 20px;
    transition: all 0.3s ease;
}
#nextPageLink:hover {
    text-decoration: underline;
    color: #0056b3;
    transform: scale(1.05);
}

/* お知らせボード */
.notice-board {
    background-color: #ffeeba;
    margin: 20px auto;
    max-width: 900px;
    width: 100%;
    border: 1px solid #d1d5db;
    border-radius: 5px;
    padding: 15px;
    box-sizing: border-box;
    text-align: center;
}

/* テキスト装飾 */
.red-bold { color: red; font-weight: bold; }
.blue-bold { color: #007bff; font-weight: bold; }
.blue-text { color: #007bff; font-weight: normal; font-size: 20px; }

/* ===== 横スライド切り替え用 ===== */
#slides {
    display: flex;
    overflow: hidden;
    width: 100%;
    max-width: 900px;
    margin: 0 auto;
    box-sizing: border-box;
    transition: transform 0.5s ease;
}

.slide {
    flex: 0 0 100%;
    box-sizing: border-box;
    min-height: 60vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

/* Nextボタンエリア */
.nav-next {
    display: flex;
    justify-content: flex-end;
    width: 100%;
    max-width: 900px;
    margin: 20px auto;
    padding: 0 20px;
    box-sizing: border-box;
}
.nav-next button {
    padding: 10px 20px;
    font-size: 18px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    background: #007bff;
    color: #fff;
}
.nav-next button:disabled {
    background: #ccc;
    cursor: not-allowed;
}
</style>
</head>
<body>
  <div id="slides">
    <!-- Slide 1: Video 1 -->
    <div class="slide" data-type="video">
      <video id="video1" controls width="480">
        <source src="https://raw.githubusercontent.com/moguura/my-images/main/Activity4-1.mp4" type="video/mp4">
      </video>
      <div class="nav-next">
        <button id="nextVideo1" disabled>Next</button>
      </div>
    </div>

    <!-- Slide 2: Example 1 -->
    <div class="slide" data-id="E1">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-rei1.JPG" alt="例題1" width="500">
      <button class="mic-button" id="startButtonE1"></button>
      <audio id="cueE1" src="https://raw.githubusercontent.com/moguura/my-images/main/4-rei.wav"></audio>
      <audio id="correctAudioE1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioE1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackE1" class="feedback-text">
        <img id="correctImageE1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png" alt="正解アイコン">
        <img id="wrongImageE1"   src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png" alt="不正解アイコン">
        <p id="feedbackTextE1"></p>
      </div>
      <div class="nav-next">
        <button id="nextE1" disabled>Next</button>
      </div>
    </div>

    <!-- Slide 3: Video 2 -->
    <div class="slide" data-type="video">
      <p><strong>Now watch the next instruction:</strong></p>
      <video id="video2" controls width="480">
        <source src="https://raw.githubusercontent.com/moguura/my-images/main/Activity4-2.mp4" type="video/mp4">
      </video>
      <div class="nav-next">
        <button id="nextVideo2" disabled>Next</button>
      </div>
    </div>

    <!-- Slide 4: Example 2 -->
    <div class="slide" data-id="E2">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-rei2.JPG" alt="例題2" width="500">
      <button class="mic-button" id="startButtonE2"></button>
      <audio id="cueE2" src="https://raw.githubusercontent.com/moguura/my-images/main/4-rei.wav"></audio>
      <audio id="correctAudioE2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioE2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackE2" class="feedback-text">
        <img id="correctImageE2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png" alt="正解アイコン">
        <img id="wrongImageE2"   src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png" alt="不正解アイコン">
        <p id="feedbackTextE2"></p>
      </div>
      <div class="nav-next">
        <button id="nextE2" disabled>Next</button>
      </div>
    </div>

    <!-- Slide 5: Instruction Box -->
    <div class="slide" data-type="instruction">
      <div class="instructions">
        <p>
          Now, please speak in the same way for the following activities.<br>
          You can speak into the microphone <span class="red-bold">just once</span>.
        </p>
      </div>
      <div class="nav-next">
        <button id="nextToQ" disabled>Next</button>
      </div>
    </div>

    <!-- Q1 -->
    <div class="slide" data-id="Q1">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-1.JPG" alt="問題1" width="500">
      <button class="mic-button" id="startButtonQ1"></button>
      <audio id="cueQ1" src="https://raw.githubusercontent.com/moguura/my-images/main/4-1.wav"></audio>
      <audio id="correctAudioQ1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioQ1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackQ1" class="feedback-text">
        <img id="correctImageQ1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png" alt="正解アイコン">
        <img id="wrongImageQ1"   src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png" alt="不正解アイコン">
        <p id="feedbackTextQ1"></p>
      </div>
      <div class="nav-next">
        <button id="nextQ1" disabled>Next</button>
      </div>
    </div>
<!-- Q2 -->
<div class="slide" data-id="Q2">
  <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-2.JPG" alt="問題2" width="500">
  <button class="mic-button" id="startButtonQ2"></button>
  <audio id="cueQ2" src="https://raw.githubusercontent.com/moguura/my-images/main/4-2.wav"></audio>
  <audio id="correctAudioQ2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
  <audio id="wrongAudioQ2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
  <div id="feedbackQ2" class="feedback-text">
    <img id="correctImageQ2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png" alt="正解アイコン">
    <img id="wrongImageQ2"   src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png" alt="不正解アイコン">
    <p id="feedbackTextQ2"></p>
  </div>
  <div class="nav-next">
    <button id="nextQ2" disabled>Next</button>
  </div>
</div>

<!-- Q3 -->
<div class="slide" data-id="Q3">
  <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-3.JPG" alt="問題3" width="500">
  <button class="mic-button" id="startButtonQ3"></button>
  <audio id="cueQ3" src="https://raw.githubusercontent.com/moguura/my-images/main/4-3.wav"></audio>
  <audio id="correctAudioQ3" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
  <audio id="wrongAudioQ3" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
  <div id="feedbackQ3" class="feedback-text">
    <img id="correctImageQ3" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png" alt="正解アイコン">
    <img id="wrongImageQ3"   src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png" alt="不正解アイコン">
    <p id="feedbackTextQ3"></p>
  </div>
  <div class="nav-next">
    <button id="nextQ3" disabled>Next</button>
  </div>
</div>

<!-- Q4 -->
<div class="slide" data-id="Q4">
  <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-4.JPG" alt="問題4" width="500">
  <button class="mic-button" id="startButtonQ4"></button>
  <audio id="cueQ4" src="https://raw.githubusercontent.com/moguura/my-images/main/4-4.wav"></audio>
  <audio id="correctAudioQ4" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
  <audio id="wrongAudioQ4" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
  <div id="feedbackQ4" class="feedback-text">
    <img id="correctImageQ4" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png" alt="正解アイコン">
    <img id="wrongImageQ4"   src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png" alt="不正解アイコン">
    <p id="feedbackTextQ4"></p>
  </div>
  <div class="nav-next">
    <button id="nextQ4" disabled>Next</button>
  </div>
</div>

<!-- Q5 -->
<div class="slide" data-id="Q5">
  <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-5.JPG" alt="問題5" width="500">
  <button class="mic-button" id="startButtonQ5"></button>
  <audio id="cueQ5" src="https://raw.githubusercontent.com/moguura/my-images/main/4-5.wav"></audio>
  <audio id="correctAudioQ5" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
  <audio id="wrongAudioQ5" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
  <div id="feedbackQ5" class="feedback-text">
    <img id="correctImageQ5" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png" alt="正解アイコン">
    <img id="wrongImageQ5"   src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png" alt="不正解アイコン">
    <p id="feedbackTextQ5"></p>
  </div>
  <div class="nav-next">
    <button id="nextQ5" disabled>Next</button>
  </div>
</div>
      
<!-- Q6 -->
<div class="slide" data-id="Q6">
  <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-6.JPG" alt="問題6" width="500">
  <button class="mic-button" id="startButtonQ6"></button>
  <audio id="cueQ6" src="https://raw.githubusercontent.com/moguura/my-images/main/4-6.wav"></audio>
  <audio id="correctAudioQ6" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
  <audio id="wrongAudioQ6" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
  <div id="feedbackQ6" class="feedback-text">
    <img id="correctImageQ6" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png" alt="正解アイコン">
    <img id="wrongImageQ6"   src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png" alt="不正解アイコン">
    <p id="feedbackTextQ6"></p>
  </div>
  <div class="nav-next">
    <button id="nextQ6" disabled>Next</button>
  </div>
</div>

<!-- Q7 -->
<div class="slide" data-id="Q7">
  <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-7.JPG" alt="問題7" width="500">
  <button class="mic-button" id="startButtonQ7"></button>
  <audio id="cueQ7" src="https://raw.githubusercontent.com/moguura/my-images/main/4-7.wav"></audio>
  <audio id="correctAudioQ7" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
  <audio id="wrongAudioQ7" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
  <div id="feedbackQ7" class="feedback-text">
    <img id="correctImageQ7" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png" alt="正解アイコン">
    <img id="wrongImageQ7"   src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png" alt="不正解アイコン">
    <p id="feedbackTextQ7"></p>
  </div>
  <div class="nav-next">
    <button id="nextQ7" disabled>Next</button>
  </div>
</div>

<!-- Q8 -->
<div class="slide" data-id="Q8">
  <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-8.JPG" alt="問題8" width="500">
  <button class="mic-button" id="startButtonQ8"></button>
  <audio id="cueQ8" src="https://raw.githubusercontent.com/moguura/my-images/main/4-8.wav"></audio>
  <audio id="correctAudioQ8" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
  <audio id="wrongAudioQ8" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
  <div id="feedbackQ8" class="feedback-text">
    <img id="correctImageQ8" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png" alt="正解アイコン">
    <img id="wrongImageQ8"   src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png" alt="不正解アイコン">
    <p id="feedbackTextQ8"></p>
  </div>
  <div class="nav-next">
    <button id="nextQ8" disabled>Next</button>
  </div>
</div>

<!-- Q9 -->
<div class="slide" data-id="Q9">
  <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-9.JPG" alt="問題9" width="500">
  <button class="mic-button" id="startButtonQ9"></button>
  <audio id="cueQ9" src="https://raw.githubusercontent.com/moguura/my-images/main/4-9.wav"></audio>
  <audio id="correctAudioQ9" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
  <audio id="wrongAudioQ9" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
  <div id="feedbackQ9" class="feedback-text">
    <img id="correctImageQ9" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png" alt="正解アイコン">
    <img id="wrongImageQ9"   src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png" alt="不正解アイコン">
    <p id="feedbackTextQ9"></p>
  </div>
  <div class="nav-next">
    <button id="nextQ9" disabled>Next</button>
  </div>
</div>

<!-- Q10 -->
<div class="slide" data-id="Q10">
  <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-10.JPG" alt="問題10" width="500">
  <button class="mic-button" id="startButtonQ10"></button>
  <audio id="cueQ10" src="https://raw.githubusercontent.com/moguura/my-images/main/4-10.wav"></audio>
  <audio id="correctAudioQ10" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
  <audio id="wrongAudioQ10" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
  <div id="feedbackQ10" class="feedback-text">
    <img id="correctImageQ10" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png" alt="正解アイコン">
    <img id="wrongImageQ10"  src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png" alt="不正解アイコン">
    <p id="feedbackTextQ10"></p>
  </div>
  <div class="nav-next">
    <button id="nextQ10" disabled>Next</button>
  </div>
</div>
<div class="nav-next">
  <button id="nextButton">Next</button>
</div>

<!-- 次ページリンク -->
  <a id="nextPageLink" href="Activity5.html">Go to Activity5</a>
</div> <!-- #slides をここで閉じる -->

<!-- クリック音・終了音 -->
<audio id="clickSound" src="…/click.mp3"></audio>
<audio id="taskEndSound" src="…/taskend2.mp3"></audio>
    
<script>
(function() {
  const container = document.getElementById('slides');
  // .slide 要素だけを取得
  const slides = Array.from(container.querySelectorAll('.slide'));
  const nextPageLink = document.getElementById('nextPageLink');
  let currentIndex = 0;

  // 各スライド内の Next ボタンを収集
  const nextButtons = slides.map(slide =>
    slide.querySelector('.nav-next button')
  );

  // 最初はリンク非表示
  nextPageLink.style.display = 'none';

  // 正答データ
  const answers = {
    E1: ["よかった"], E2: ["よくなかった"],
    Q1: ["忙しかった"], Q2: ["高くなかった"], Q3: ["寒くなかった"], Q4: ["大きくなかった"],
    Q5: ["近かった"], Q6: ["新しくなかった"], Q7: ["多くなかった"], Q8: ["暑かった"],
    Q9: ["おいしくなかった"], Q10: ["安くなかった"]
  };

  function normalizeText(text) {
    return text.replace(/\s+/g, '').replace(/です$/, '');
  }

  function isCorrectAnswer(id, input) {
    const norm = normalizeText(input);
    const correct = answers[id][0];
    if (correct.endsWith('くなかった')) {
      return norm.endsWith('くなかった');
    } else {
      return norm.endsWith('かった') && !norm.endsWith('くなかった');
    }
  }

  function getFeedbackText(id) {
    const msgs = {
      E1: "えいがは よかったです。（The movie was good.）",
      E2: "えいがは よくなかったです。（The movie was not good.）",
      Q1: "せんしゅうは いそがしかったです。（I was busy last week.）",
      Q2: "りょうりは たかくなかったです。（The meal was not expensive.）",
      Q3: "２がつは さむくなかったです。（February was not cold.）",
      Q4: "ケーキは おおきくなかったです。（The cake was not big.）",
      Q5: "ホテルは ちかかったです。（The hotel was close.）",
      Q6: "レストランは あたらしくなかったです。（The restaurant was not new.）",
      Q7: "ゆきは おおくなかったです。（There was not much snow.）",
      Q8: "８がつは あつかったです。（August was hot.）",
      Q9: "パンは おいしくなかったです。（The bread was not good.）",
      Q10:"チケットは やすくなかったです。（The ticket was not cheap.）"
    };
    return msgs[id] || '';
  }

  function showFeedback(id, correct) {
    const imgC = document.getElementById(`correctImage${id}`);
    const imgW = document.getElementById(`wrongImage${id}`);
    const txt  = document.getElementById(`feedbackText${id}`);
    imgC.style.display = correct ? 'inline-block' : 'none';
    imgW.style.display = correct ? 'none' : 'inline-block';
    txt.textContent  = getFeedbackText(id);
    if (correct) document.getElementById(`correctAudio${id}`).play();
    else         document.getElementById(`wrongAudio${id}`).play();
  }

  // スライド移動
  function goToSlide(idx) {
    // idx は 0 〜 slides.length - 1 の範囲内
    if (idx < 0 || idx >= slides.length) return;
    currentIndex = idx;
    container.style.transform = `translateX(-${100 * currentIndex}%)`;
    // 説明ボックス(slide内に .instructions)なら即 Next 有効化
    const inst = slides[currentIndex].querySelector('.instructions');
    if (inst && nextButtons[currentIndex]) {
      nextButtons[currentIndex].disabled = false;
    }
    // 最後のスライドに到達したらリンク表示
    if (currentIndex === slides.length - 1) {
      nextPageLink.style.display = 'block';
    }
  }

  // Next ボタン設定
  nextButtons.forEach((btn, idx) => {
    if (!btn) return;
    btn.disabled = true;
    btn.addEventListener('click', () => {
      btn.disabled = true;
      goToSlide(idx + 1);
    });
  });

  // 動画再生完了で Next 有効化
  ['video1', 'video2'].forEach((vid, i) => {
    const video = document.getElementById(vid);
    const btn   = document.getElementById(i === 0 ? 'nextVideo1' : 'nextVideo2');
    if (video && btn) {
      video.addEventListener('ended', () => btn.disabled = false);
    }
  });

  // 音声認識→フィードバック→Next有効化
  function startRecognition(id) {
    if (!('webkitSpeechRecognition' in window)) return;
    const rec   = new webkitSpeechRecognition();
    const btnMic = document.getElementById(`startButton${id}`);
    rec.lang    = 'ja-JP';
    btnMic.classList.add('recording');
    rec.onresult = e => {
      const transcript = e.results[0][0].transcript.trim();
      const ok = isCorrectAnswer(id, transcript);
      showFeedback(id, ok);
      // フィードバックが表示されたら Next を有効化
      const nextBtn = document.getElementById(`next${id}`);
      if (nextBtn) nextBtn.disabled = false;
    };
    rec.onend = () => btnMic.classList.remove('recording');
    rec.start();
  }

  // マイクボタンに認識開始を紐付け
  document.querySelectorAll('.mic-button').forEach(btn => {
    btn.addEventListener('click', () => {
      document.getElementById('clickSound')?.play();
      const id = btn.id.replace('startButton', '');
      startRecognition(id);
    });
  });

  // 初期セットアップ
  container.style.transition = 'transform 0.5s ease';
  goToSlide(0);
})();
</script>
</body>
</html>

