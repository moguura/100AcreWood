<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Activity4</title>
  <style>
    body { margin:0; padding:0; font-family:Arial,sans-serif; background:#f9f9f9; color:#333; font-size:24px; display:flex; flex-direction:column; align-items:center; justify-content:center; }
    #slides { width:100%; max-width:900px; margin:0 auto; box-sizing:border-box; position:relative; }
    .slide { display:none; width:100%; box-sizing:border-box; min-height:60vh; display:flex; flex-direction:column; justify-content:center; align-items:center; }
    .slide.active { display:flex; }
    .mic-button { background:url("https://raw.githubusercontent.com/moguura/my-images/main/%E3%83%9E%E3%82%A4%E3%82%AF%E3%81%AE%E3%83%95%E3%83%AA%E3%83%BC%E3%82%A2%E3%82%A4%E3%82%B3%E3%83%B3%E3%81%9D%E3%81%AE21.png") center/cover no-repeat; border:none; width:70px; height:70px; border-radius:50%; cursor:pointer; margin:10px auto; transition:box-shadow .3s; }
    .mic-button.recording { box-shadow:0 0 15px rgba(255,0,0,.8); }
    .mic-button:disabled { background:#ccc; cursor:not-allowed; }
    .feedback-text { display:none; text-align:center; margin-top:8px; }
    .feedback-text img { width:32px; margin-right:6px; }
    .instructions { background:#fff; border:1px solid #d1d5db; border-radius:5px; padding:15px; max-width:900px; width:100%; text-align:center; box-shadow:0 1px 3px rgba(0,0,0,.1); margin:0 auto; }
    .instructions span.red-bold { color:red; font-weight:bold; }
    .nav-next { width:100%; max-width:900px; margin:20px auto; padding:0 20px; display:flex; justify-content:flex-end; }
    .nav-next button { padding:10px 20px; font-size:18px; border:none; border-radius:5px; background:#007bff; color:#fff; cursor:pointer; }
    .nav-next button:disabled { background:#ccc; cursor:not-allowed; }
    #nextPageLink { display:none; text-align:center; margin:30px auto; font-size:28px; font-weight:bold; color:#007bff; text-decoration:none; padding:10px 20px; transition:all .3s; }
    #nextPageLink:hover { text-decoration:underline; transform:scale(1.05); }
  </style>
</head>
<body>
  <div id="slides">
    <!-- Slide 1: Video 1 -->
    <div class="slide active" data-type="video">
      <video controls width="480">
        <source src="https://raw.githubusercontent.com/moguura/my-images/main/Activity4-1.mp4" type="video/mp4">
      </video>
    </div>

    <!-- Slide 2: Example 1 -->
    <div class="slide" data-type="example" data-id="E1">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-rei1.JPG" alt="例題1" width="500">
      <button class="mic-button" id="startButtonE1"></button>
      <audio id="cueE1" src="https://raw.githubusercontent.com/moguura/my-images/main/4-rei.wav"></audio>
      <audio id="correctAudioE1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioE1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackE1" class="feedback-text">
        <img id="correctImageE1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png">
        <img id="wrongImageE1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png">
        <p id="feedbackTextE1"></p>
      </div>
    </div>

    <!-- Slide 3: Video 2 -->
    <div class="slide" data-type="video">
      <p><strong>Now watch the next instruction:</strong></p>
      <video controls width="480">
        <source src="https://raw.githubusercontent.com/moguura/my-images/main/Activity4-2.mp4" type="video/mp4">
      </video>
    </div>

    <!-- Slide 4: Example 2 -->
    <div class="slide" data-type="example" data-id="E2">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-rei2.JPG" alt="例題2" width="500">
      <button class="mic-button" id="startButtonE2"></button>
      <audio id="cueE2" src="https://raw.githubusercontent.com/moguura/my-images/main/4-rei.wav"></audio>
      <audio id="correctAudioE2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioE2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackE2" class="feedback-text">
        <img id="correctImageE2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png">
        <img id="wrongImageE2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png">
        <p id="feedbackTextE2"></p>
      </div>
    </div>

    <!-- Slide 5: Instruction Box -->
    <div class="slide" data-type="instruction">
      <div class="instructions">
        <p>Now, please speak in the same way for the following activities.<br>
        You can speak into the microphone <span class="red-bold">just once</span>.</p>
      </div>
    </div>
  </div>
    <!-- Q1 -->
    <div class="slide">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-1.JPG" alt="問題1" width="500">
      <button class="mic-button" id="startButtonQ1"></button>
      <audio id="cueQ1" src="https://raw.githubusercontent.com/moguura/my-images/main/4-1.wav"></audio>
      <audio id="correctAudioQ1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioQ1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackQ1" class="feedback-text"><img id="correctImageQ1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png"><img id="wrongImageQ1" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png"><p id="feedbackTextQ1"></p></div>
    </div>
    <!-- Q2 -->
    <div class="slide">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-2.JPG" alt="問題2" width="500">
      <button class="mic-button" id="startButtonQ2"></button>
      <audio id="cueQ2" src="https://raw.githubusercontent.com/moguura/my-images/main/4-2.wav"></audio>
      <audio id="correctAudioQ2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioQ2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackQ2" class="feedback-text"><img id="correctImageQ2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png"><img id="wrongImageQ2" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png"><p id="feedbackTextQ2"></p></div>
    </div>
    <!-- Q3 -->
    <div class="slide">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-3.JPG" alt="問題3" width="500">
      <button class="mic-button" id="startButtonQ3"></button>
      <audio id="cueQ3" src="https://raw.githubusercontent.com/moguura/my-images/main/4-3.wav"></audio>
      <audio id="correctAudioQ3" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioQ3" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackQ3" class="feedback-text"><img id="correctImageQ3" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png"><img id="wrongImageQ3" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png"><p id="feedbackTextQ3"></p></div>
    </div>
    <!-- Q4 -->
    <div class="slide">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-4.JPG" alt="問題4" width="500">
      <button class="mic-button" id="startButtonQ4"></button>
      <audio id="cueQ4" src="https://raw.githubusercontent.com/moguura/my-images/main/4-4.wav"></audio>
      <audio id="correctAudioQ4" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioQ4" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackQ4" class="feedback-text"><img id="correctImageQ4" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png"><img id="wrongImageQ4" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png"><p id="feedbackTextQ4"></p></div>
    </div>
  <div id="slides">
    <!-- Q5 -->
    <div class="slide">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-5.JPG" alt="問題5" width="500">
      <button class="mic-button" id="startButtonQ5"></button>
      <audio id="cueQ5" src="https://raw.githubusercontent.com/moguura/my-images/main/4-5.wav"></audio>
      <audio id="correctAudioQ5" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioQ5" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackQ5" class="feedback-text">
        <img id="correctImageQ5" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png">
        <img id="wrongImageQ5" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png">
        <p id="feedbackTextQ5"></p>
      </div>
    </div>
    <!-- Q6 -->
    <div class="slide">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-6.JPG" alt="Q6" width="500">
      <button class="mic-button" id="startButtonQ6"></button>
      <audio id="cueQ6" src="https://raw.githubusercontent.com/moguura/my-images/main/4-6.wav"></audio>
      <audio id="correctAudioQ6" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioQ6" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackQ6" class="feedback-text">
        <img id="correctImageQ6" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png">
        <img id="wrongImageQ6" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png">
        <p id="feedbackTextQ6"></p>
      </div>
    </div>
    <!-- Q7 -->
    <div class="slide">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-7.JPG" alt="Q7" width="500">
      <button class="mic-button" id="startButtonQ7"></button>
      <audio id="cueQ7" src="https://raw.githubusercontent.com/moguura/my-images/main/4-7.wav"></audio>
      <audio id="correctAudioQ7" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioQ7" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackQ7" class="feedback-text">
        <img id="correctImageQ7" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png">
        <img id="wrongImageQ7" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png">
        <p id="feedbackTextQ7"></p>
      </div>
    </div>
    <!-- Q8 -->
    <div class="slide">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-8.JPG" alt="Q8" width="500">
      <button class="mic-button" id="startButtonQ8"></button>
      <audio id="cueQ8" src="https://raw.githubusercontent.com/moguura/my-images/main/4-8.wav"></audio>
      <audio id="correctAudioQ8" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioQ8" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackQ8" class="feedback-text">
        <img id="correctImageQ8" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png">
        <img id="wrongImageQ8" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png">
        <p id="feedbackTextQ8"></p>
      </div>
    </div>
    <!-- Q9 -->
    <div class="slide">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-9.JPG" alt="Q9" width="500">
      <button class="mic-button" id="startButtonQ9"></button>
      <audio id="cueQ9" src="https://raw.githubusercontent.com/moguura/my-images/main/4-9.wav"></audio>
      <audio id="correctAudioQ9" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioQ9" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackQ9" class="feedback-text">
        <img id="correctImageQ9" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png">
        <img id="wrongImageQ9" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png">
        <p id="feedbackTextQ9"></p>
      </div>
    </div>
    <!-- Q10 -->
    <div class="slide">
      <img src="https://raw.githubusercontent.com/moguura/my-images/main/4-10.JPG" alt="Q10" width="500">
      <button class="mic-button" id="startButtonQ10"></button>
      <audio id="cueQ10" src="https://raw.githubusercontent.com/moguura/my-images/main/4-10.wav"></audio>
      <audio id="correctAudioQ10" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E6%AD%A3%E8%A7%A32.mp3"></audio>
      <audio id="wrongAudioQ10" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%82%AF%E3%82%A4%E3%82%BA%E4%B8%8D%E6%AD%A3%E8%A7%A31.mp3"></audio>
      <div id="feedbackQ10" class="feedback-text">
        <img id="correctImageQ10" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%BE%E3%82%8B.png">
        <img id="wrongImageQ10" src="https://raw.githubusercontent.com/moguura/my-images/main/%E3%81%B0%E3%81%A4.png">
        <p id="feedbackTextQ10"></p>
      </div>
    </div>
  </div>
  <div class="nav-next">
    <button id="nextButton">Next</button>
  </div>
  <a id="nextPageLink" href="next_page.html">Go to Activity5</a>
  <audio id="clickSound" src="https://raw.githubusercontent.com/moguura/my-images/main/click.mp3"></audio>
  <audio id="taskEndSound" src="https://raw.githubusercontent.com/moguura/my-images/main/taskend2.mp3"></audio>
    
<script>
  const slides = Array.from(document.querySelectorAll('.slide'));
  const nextBtn = document.getElementById('nextButton');
  const nextLink = document.getElementById('nextPageLink');
  let currentSlide = 0;

  // スライド表示制御
  function showSlide(idx) {
    slides[currentSlide].classList.remove('active');
    currentSlide = idx;
    slides[currentSlide].classList.add('active');
    nextBtn.disabled = true;
    if (slides[currentSlide].dataset.type === 'instruction') {
      nextBtn.disabled = false;
    }
  }

  // Nextボタン押下
  nextBtn.addEventListener('click', () => {
    document.getElementById('clickSound').play();
    showSlide(currentSlide + 1);
    if (currentSlide === slides.length - 1) {
      nextBtn.disabled = true;
      nextLink.style.display = 'block';
      setTimeout(() => document.getElementById('taskEndSound').play(), 2000);
    }
  });

  // ビデオ終了でNext有効化
  document.querySelectorAll('.slide[data-type="video"] video')
    .forEach(video => video.addEventListener('ended', () => {
      if (slides[currentSlide].contains(video)) {
        nextBtn.disabled = false;
      }
    }));

  // 正答データ
  const answers = {
    E1: ["よかった"], E2: ["よくなかった"],
    Q1: ["忙しかった"], Q2: ["高くなかった"], Q3: ["寒くなかった"], Q4: ["大きくなかった"],
    Q5: ["近かった"], Q6: ["新しくなかった"], Q7: ["多くなかった"], Q8: ["暑かった"],
    Q9: ["おいしくなかった"], Q10: ["安くなかった"]
  };

  function normalizeText(text) {
    return text.replace(/\s+/g, '').replace(/です$/, '');
  }

  function isCorrectAnswer(id, input) {
    const norm = normalizeText(input);
    const correct = answers[id][0];
    if (correct.endsWith('くなかった')) {
      return norm.endsWith('くなかった');
    } else {
      return norm.endsWith('かった') && !norm.endsWith('くなかった');
    }
  }

  function getFeedbackText(id) {
    const msgs = {
      E1: "えいがは よかったです。（The movie was good.）",
      E2: "えいがは よくなかったです。（The movie was not good.）",
      Q1: "せんしゅうは いそがしかったです。（I was busy last week.）",
      Q2: "りょうりは たかくなかったです。（The meal was not expensive.）",
      Q3: "２がつは さむくなかったです。（February was not cold.）",
      Q4: "ケーキは おおきくなかったです。（The cake was not big.）",
      Q5: "ホテルは ちかかったです。（The hotel was close.）",
      Q6: "レストランは あたらしくなかったです。（The restaurant was not new.）",
      Q7: "ゆきは おおくなかったです。（There was not much snow.）",
      Q8: "８がつは あつかったです。（August was hot.）",
      Q9: "パンは おいしくなかったです。（The bread was not good.）",
      Q10:"チケットは やすくなかったです。（The ticket was not cheap.）"
    };
    return msgs[id] || '';
  }

  function showFeedback(id, correct) {
    const fb = document.getElementById(`feedback${id}`);
    const imgC = document.getElementById(`correctImage${id}`);
    const imgW = document.getElementById(`wrongImage${id}`);
    const txt = document.getElementById(`feedbackText${id}`);
    imgC.style.display = correct ? 'inline-block' : 'none';
    imgW.style.display = correct ? 'none' : 'inline-block';
    txt.textContent = getFeedbackText(id);
    fb.style.display = 'block';
    if (correct) document.getElementById(`correctAudio${id}`).play();
    else document.getElementById(`wrongAudio${id}`).play();
    // フィードバック後Next有効化
    if (slides[currentSlide].dataset.id === id) {
      nextBtn.disabled = false;
    }
  }

  // 音声認識開始
  function startRecognition(id) {
    if (!('webkitSpeechRecognition' in window)) return;
    const rec = new webkitSpeechRecognition();
    rec.lang = 'ja-JP';
    const btn = document.getElementById(`startButton${id}`);
    btn.classList.add('recording');
    rec.onresult = e => {
      const transcript = e.results[0][0].transcript.trim();
      const ok = isCorrectAnswer(id, transcript);
      showFeedback(id, ok);
    };
    rec.onend = () => btn.classList.remove('recording');
    rec.start();
  }

  // マイクボタン登録
  document.querySelectorAll('.mic-button').forEach(btn => {
    btn.addEventListener('click', () => {
      document.getElementById('clickSound').play();
      startRecognition(btn.id.replace('startButton', ''));
    });
  });
</script>
